/*!
 * Start Bootstrap - Creative v5.0.3 (https://startbootstrap.com/template-overviews/creative)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-creative/blob/master/LICENSE)
 */

var recorder,microphone,$text=$("h2.main-text"),$submit=$("button#submit"),$recBtn=$("button#rec-btn"),$username=$("input#username"),audio=document.querySelector("audio"),isEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function captureMicrophone(r){microphone?r(microphone):(void 0!==navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||(alert("This browser does not supports WebRTC getUserMedia API."),navigator.getUserMedia&&alert("This browser seems supporting deprecated getUserMedia API.")),navigator.mediaDevices.getUserMedia({audio:!!isEdge||{echoCancellation:!1}}).then(function(e){r(e)}).catch(function(e){alert("Unable to capture your microphone. Please check console logs."),console.error(e)}))}function replaceAudio(e){var r=document.createElement("audio");r.controls=!0,r.autoplay=!0,e&&(r.src=e);var o=audio.parentNode;o.innerHTML="",o.appendChild(r),audio=r}function stopRecordingCallback(){replaceAudio(URL.createObjectURL(recorder.getBlob())),setTimeout(function(){audio.paused&&(setTimeout(function(){audio.paused&&audio.play()},1e3),audio.play())},300),audio.play(),isSafari&&microphone&&(microphone.stop(),microphone=null)}function setupWizardListener(){ref.on("value",function(e){var r=e.val();$text.text(r.word)})}function startAudioRecording(){if(!microphone)return captureMicrophone(function(e){if(microphone=e,isSafari)return replaceAudio(),audio.muted=!0,audio.srcObject=microphone,void alert("Please click startRecording button again. First time we tried to access your microphone. Now we will record it.")}),void console.log("Microphone initialized");replaceAudio(),audio.muted=!0,audio.srcObject=microphone;var e={type:"audio",numberOfAudioChannels:isEdge?1:2,checkForInactiveTracks:!0,bufferSize:16384};(isSafari||isEdge)&&(e.recorderType=StereoAudioRecorder),navigator.platform&&-1===navigator.platform.toString().toLowerCase().indexOf("win")&&(e.sampleRate=48e3),isSafari&&(e.sampleRate=44100,e.bufferSize=4096,e.numberOfAudioChannels=2),recorder&&(recorder.destroy(),recorder=null),(recorder=RecordRTC(microphone,e)).startRecording()}function stopAudioRecording(){recorder.stopRecording(stopRecordingCallback)}function getFileName(e){var r=new Date;return $username.val()+"-recording-"+r.toString()+"."+e}$recBtn.click(function(){$recBtn.hasClass("not-rec")?($recBtn.removeClass("not-rec"),$recBtn.addClass("rec"),startAudioRecording()):($recBtn.removeClass("rec"),$recBtn.addClass("not-rec"),stopAudioRecording())}),$submit.click(function(){if(0!=$username.val().length)if(recorder&&recorder.getBlob()){var e=recorder.getBlob(),r=getFileName("mp3"),o=new File([e],r,{type:"audio/mp3"});audioRef.child(r).put(o).then(function(e){console.log("Uploaded audio file!"),alert("Audio file uploaded! We will provide you with the report shortly.")})}else alert("Please ensure recording is done.");else alert("Please enter your name.")}),startAudioRecording(),$recBtn.addClass("not-rec");